<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_zid_stock_update_log_tree" model="ir.ui.view">
        <field name="name">zid.stock.update.log.tree</field>
        <field name="model">zid.stock.update.log</field>
        <field name="arch" type="xml">
            <list string="Stock Update Logs" 
                  decoration-success="status == 'success'"
                  decoration-danger="status in ['failed', 'error']"
                  decoration-warning="status == 'partial'"
                  decoration-muted="status == 'cancelled'"
                  decoration-info="status in ['pending', 'processing']"
                  default_order="create_date desc">
                <field name="reference"/>
                <field name="create_date" string="Date" widget="datetime"/>
                <field name="product_id"/>
                <field name="product_sku" optional="show"/>
                <field name="odoo_location_id" optional="show"/>
                <field name="zid_location_id" optional="show"/>
                <field name="quantity_change_odoo" widget="float" 
                       decoration-success="quantity_change_odoo > 0"
                       decoration-danger="quantity_change_odoo &lt; 0"/>
                <field name="quantity_change_zid" widget="float"
                       decoration-success="quantity_change_zid > 0"
                       decoration-danger="quantity_change_zid &lt; 0"/>
                <field name="operation_type"/>
                <field name="sync_direction"/>
                <field name="status" widget="badge" 
                       decoration-success="status == 'success'"
                       decoration-danger="status in ['failed', 'error']"
                       decoration-warning="status == 'partial'"
                       decoration-info="status in ['pending', 'processing']"/>
                <field name="response_code" optional="hide"/>
                <field name="duration" widget="float_time" optional="show"/>
                <field name="user_id" widget="many2one_avatar_user" optional="show"/>
            </list>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_zid_stock_update_log_form" model="ir.ui.view">
        <field name="name">zid.stock.update.log.form</field>
        <field name="model">zid.stock.update.log</field>
        <field name="arch" type="xml">
            <form string="Stock Update Log">
                <header>
                    <field name="status" widget="statusbar" 
                           statusbar_visible="pending,processing,success,failed"/>
                    <button name="action_retry" 
                            string="Retry" 
                            type="object" 
                            class="btn-warning"
                            invisible="not can_retry"
                            icon="fa-refresh"/>
                </header>
                <sheet>
                    <widget name="web_ribbon" 
                            title="Success" 
                            bg_color="bg-success"
                            invisible="status != 'success'"/>
                    <widget name="web_ribbon" 
                            title="Failed" 
                            bg_color="bg-danger"
                            invisible="status not in ['failed', 'error']"/>
                    <widget name="web_ribbon" 
                            title="Partial" 
                            bg_color="bg-warning"
                            invisible="status != 'partial'"/>
                    
                    <div class="oe_title">
                        <h1>
                            <field name="reference" readonly="1"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="Product Information">
                            <field name="product_id" readonly="1"/>
                            <field name="product_sku" readonly="1"/>
                            <field name="product_barcode" readonly="1"/>
                            <field name="zid_product_id" readonly="1"/>
                            <field name="zid_product_line_id" readonly="1"/>
                        </group>
                        <group string="Operation Details">
                            <field name="operation_type" readonly="status != 'pending'"/>
                            <field name="trigger_source" readonly="status != 'pending'"/>
                            <field name="sync_direction" readonly="status != 'pending'"/>
                            <field name="zid_connector_id" readonly="1"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Quantity Changes" name="quantities">
                            <group>
                                <group string="Odoo Stock">
                                    <field name="odoo_location_id" readonly="1"/>
                                    <field name="quantity_before_odoo" readonly="1"/>
                                    <field name="quantity_after_odoo" readonly="1"/>
                                    <field name="quantity_change_odoo" readonly="1" 
                                           widget="float"
                                           style="font-weight: bold; font-size: 1.2em;"/>
                                </group>
                                <group string="Zid Stock">
                                    <field name="zid_location_id" readonly="1"/>
                                    <field name="quantity_before_zid" readonly="1"/>
                                    <field name="quantity_after_zid" readonly="1"/>
                                    <field name="quantity_change_zid" readonly="1"
                                           widget="float"
                                           style="font-weight: bold; font-size: 1.2em;"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="API Communication" name="api">
                            <group>
                                <group string="Request">
                                    <field name="api_endpoint" readonly="1"/>
                                    <field name="api_method" readonly="1"/>
                                    <button name="action_view_request_data" 
                                            string="View Request Data" 
                                            type="object"
                                            class="btn-link"
                                            invisible="not request_data"/>
                                </group>
                                <group string="Response">
                                    <field name="response_code" readonly="1"/>
                                    <button name="action_view_response_data" 
                                            string="View Response Data" 
                                            type="object"
                                            class="btn-link"
                                            invisible="not response_data"/>
                                </group>
                            </group>
                            
                            <separator string="Request Data" invisible="not request_data"/>
                            <field name="request_data" 
                                   readonly="1" 
                                   nolabel="1"
                                   widget="ace" 
                                   options="{'mode': 'json'}"
                                   invisible="not request_data"/>
                            
                            <separator string="Response Data" invisible="not response_data"/>
                            <field name="response_data" 
                                   readonly="1" 
                                   nolabel="1"
                                   widget="ace" 
                                   options="{'mode': 'json'}"
                                   invisible="not response_data"/>
                        </page>
                        
                        <page string="Related Documents" name="documents">
                            <group>
                                <group string="Stock Documents">
                                    <field name="stock_move_id" readonly="1"/>
                                    <field name="stock_picking_id" readonly="1"/>
                                </group>
                                <group string="Order Documents">
                                    <field name="sale_order_id" readonly="1"/>
                                    <field name="purchase_order_id" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Timing &amp; Performance" name="timing">
                            <group>
                                <group string="Timing">
                                    <field name="start_time" readonly="1" widget="datetime"/>
                                    <field name="end_time" readonly="1" widget="datetime"/>
                                    <field name="duration" readonly="1" widget="float_time"/>
                                </group>
                                <group string="Retry Information">
                                    <field name="retry_count" readonly="1"/>
                                    <field name="max_retries" readonly="1"/>
                                    <field name="can_retry" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Errors" name="errors" invisible="not error_message">
                            <group string="Error Information">
                                <field name="error_message" readonly="1" nolabel="1" colspan="2"/>
                            </group>
                            <separator string="Error Details" invisible="not error_details"/>
                            <field name="error_details" 
                                   readonly="1" 
                                   nolabel="1"
                                   style="font-family: monospace; background-color: #f8f9fa;"
                                   invisible="not error_details"/>
                        </page>
                        
                        <page string="Notes" name="notes">
                            <field name="notes" nolabel="1" placeholder="Add any additional notes here..."/>
                            <group string="Metadata">
                                <field name="user_id" readonly="1"/>
                                <field name="company_id" readonly="1"/>
                                <field name="create_date" readonly="1"/>
                                <field name="write_date" readonly="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="view_zid_stock_update_log_kanban" model="ir.ui.view">
        <field name="name">zid.stock.update.log.kanban</field>
        <field name="model">zid.stock.update.log</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" default_group_by="status">
                <field name="reference"/>
                <field name="product_id"/>
                <field name="status"/>
                <field name="quantity_change_odoo"/>
                <field name="quantity_change_zid"/>
                <field name="create_date"/>
                <field name="duration"/>
                <field name="sync_direction"/>
                
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top mb-2">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="reference"/>
                                    </strong>
                                </div>
                                <field name="status" widget="label_selection" 
                                       options="{'classes': {'success': 'success', 
                                                           'failed': 'danger',
                                                           'error': 'danger',
                                                           'partial': 'warning',
                                                           'pending': 'info',
                                                           'processing': 'info'}}"/>
                            </div>
                            
                            <div class="o_kanban_record_body">
                                <div>
                                    <strong>Product:</strong> <field name="product_id"/>
                                </div>
                                <div class="text-muted">
                                    <i class="fa fa-clock-o"/> <field name="create_date" widget="datetime"/>
                                </div>
                            </div>
                            
                            <div class="o_kanban_record_bottom mt-2">
                                <div class="oe_kanban_bottom_left">
                                    <span t-if="record.sync_direction.raw_value == 'odoo_to_zid'" 
                                          class="badge badge-primary">Odoo → Zid</span>
                                    <span t-elif="record.sync_direction.raw_value == 'zid_to_odoo'" 
                                          class="badge badge-info">Zid → Odoo</span>
                                    <span t-else="" class="badge badge-secondary">↔️</span>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <span t-if="record.quantity_change_odoo.raw_value != 0" 
                                          t-attf-class="badge #{record.quantity_change_odoo.raw_value > 0 ? 'badge-success' : 'badge-danger'}">
                                        <t t-if="record.quantity_change_odoo.raw_value > 0">+</t>
                                        <field name="quantity_change_odoo"/>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Graph View -->
    <record id="view_zid_stock_update_log_graph" model="ir.ui.view">
        <field name="name">zid.stock.update.log.graph</field>
        <field name="model">zid.stock.update.log</field>
        <field name="arch" type="xml">
            <graph string="Stock Update Statistics" type="bar">
                <field name="create_date" interval="day"/>
                <field name="status" type="col"/>
            </graph>
        </field>
    </record>

    <!-- Pivot View -->
    <record id="view_zid_stock_update_log_pivot" model="ir.ui.view">
        <field name="name">zid.stock.update.log.pivot</field>
        <field name="model">zid.stock.update.log</field>
        <field name="arch" type="xml">
            <pivot string="Stock Update Analysis">
                <field name="product_id" type="row"/>
                <field name="status" type="col"/>
                <field name="quantity_change_odoo" type="measure"/>
                <field name="quantity_change_zid" type="measure"/>
                <field name="duration" type="measure" widget="float_time"/>
            </pivot>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_zid_stock_update_log_search" model="ir.ui.view">
        <field name="name">zid.stock.update.log.search</field>
        <field name="model">zid.stock.update.log</field>
        <field name="arch" type="xml">
            <search string="Search Stock Update Logs">
                <field name="reference"/>
                <field name="product_id"/>
                <field name="product_sku"/>
                <field name="product_barcode"/>
                
                <separator/>
                
                <filter string="Success" name="success" domain="[('status', '=', 'success')]"/>
                <filter string="Failed" name="failed" domain="[('status', 'in', ['failed', 'error'])]"/>
                <filter string="Pending" name="pending" domain="[('status', '=', 'pending')]"/>
                <filter string="Processing" name="processing" domain="[('status', '=', 'processing')]"/>
                
                <separator/>
                
                <filter string="Odoo to Zid" name="odoo_to_zid" 
                        domain="[('sync_direction', '=', 'odoo_to_zid')]"/>
                <filter string="Zid to Odoo" name="zid_to_odoo" 
                        domain="[('sync_direction', '=', 'zid_to_odoo')]"/>
                


                
                <separator/>
                
                <group expand="0" string="Group By">
                    <filter string="Product" name="group_product" context="{'group_by': 'product_id'}"/>
                    <filter string="Status" name="group_status" context="{'group_by': 'status'}"/>
                    <filter string="Operation Type" name="group_operation" context="{'group_by': 'operation_type'}"/>
                    <filter string="Sync Direction" name="group_direction" context="{'group_by': 'sync_direction'}"/>
                    <filter string="User" name="group_user" context="{'group_by': 'user_id'}"/>
                    <filter string="Date" name="group_date" context="{'group_by': 'create_date:day'}"/>
                    <filter string="Odoo Location" name="group_odoo_location" context="{'group_by': 'odoo_location_id'}"/>
                    <filter string="Zid Location" name="group_zid_location" context="{'group_by': 'zid_location_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Data Form View (for viewing JSON data) -->
    <record id="view_zid_stock_update_log_data_form" model="ir.ui.view">
        <field name="name">zid.stock.update.log.data.form</field>
        <field name="model">zid.stock.update.log</field>
        <field name="arch" type="xml">
            <form string="Data Viewer">
                <sheet>
                    <group>
                        <field name="reference" readonly="1"/>
                    </group>
                    <notebook>
                        <page string="Request Data" invisible="context.get('default_data_type') != 'request'">
                            <field name="request_data" 
                                   readonly="1" 
                                   nolabel="1"
                                   widget="ace" 
                                   options="{'mode': 'json'}"/>
                        </page>
                        <page string="Response Data" invisible="context.get('default_data_type') != 'response'">
                            <field name="response_data" 
                                   readonly="1" 
                                   nolabel="1"
                                   widget="ace" 
                                   options="{'mode': 'json'}"/>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button string="Close" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action -->
    <record id="action_zid_stock_update_log" model="ir.actions.act_window">
        <field name="name">Stock Update Logs</field>
        <field name="res_model">zid.stock.update.log</field>
        <field name="view_mode">list,kanban,form,graph,pivot</field>
        <field name="search_view_id" ref="view_zid_stock_update_log_search"/>
        <field name="context">{'search_default_today': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No stock update logs found
            </p>
            <p>
                This view shows all stock synchronization activities between Odoo and Zid.
                Each log entry contains detailed information about quantity changes, API calls,
                and sync status.
            </p>
        </field>
    </record>

    <!-- Menu Item -->

</odoo>
